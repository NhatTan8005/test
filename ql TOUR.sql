CREATE DATABASE QL_TOUR
GO 
USE QL_TOUR
GO 
SET DATEFORMAT DMY
GO
CREATE TABLE NHANVIEN
(
	MANV VARCHAR(12) NOT NULL PRIMARY KEY,
	TENNV NVARCHAR(32) NOT NULL,
	NGAYSINH DATE NOT NULL,
	GIOITINH NVARCHAR(6) NOT NULL,
	SDT BIGINT NOT NULL,
	CCCD BIGINT NOT NULL,
	NGAYVL DATE NOT NULL,
)
-- convert ngaysinh,gioitinh,ngayvl cua NHANVIEN
-- gugughuhi
select * from NHANVIEN
go
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL)
VALUES('NV01',N'Chu Tiến Bình','2003-12-26',N'Nam',0942617888,040203007313,'2023-07-07')
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL)
VALUES('NV02',N'Lê Văn Luyện','2003-07-26',N'Nữ',0942617887,040203007315,'2023-07-02')
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL)
VALUES('NV03',N'Trần Nhật Huy','2003-08-24',N'Nam',0942617886,040203007318,'2023-06-01')
GO
---UPDATE  NHANVIEN SET SDT = concat('0', SDT)
select * from NHANVIEN
select * from KHACHHANG
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL)
VALUES('NV23',N'qửqwerqwer','2003-08-24',N'Nam',0942617886,040203007318,'2023-06-01')
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL)
VALUES('NV22',N'dsvsdvdsv','2003-08-24',N'Nam',0942617886,040203007318,'2023-06-01')
INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL)
VALUES('NV21',N'sqrfvwer','2003-08-24',N'Nam',0942617886,040203007318,'2023-06-01')
CREATE TABLE KHACHHANG
(
	MAKH VARCHAR(12) NOT NULL PRIMARY KEY,
	TENKH NVARCHAR(32) NOT NULL,
	SDT BIGINT NOT NULL,
	GIOITINH NVARCHAR(6) NOT NULL,
	EMAIL VARCHAR(30) NOT NULL,
	DIACHI NVARCHAR(50) NOT NULL,
)
go
INSERT INTO KHACHHANG(MAKH,TENKH,SDT,GIOITINH,EMAIL,DIACHI)
VALUES('KH01',N'Trần Ngyuễn Nhật Tân',0969712444,N'Nam','tayhovippro@gmail.com',N'đường trần duy hưng, ngõ 37')
INSERT INTO KHACHHANG(MAKH,TENKH,SDT,GIOITINH,EMAIL,DIACHI)
VALUES('KH02',N'Trông Anh Ngược',0969712454,N'Nam','truonganhngoc@gmail.com',N'110 Tuệ tĩnh, khối trung hòa phường hà huy tập')
INSERT INTO KHACHHANG(MAKH,TENKH,SDT,GIOITINH,EMAIL,DIACHI)
VALUES('KH03',N'Trương Anh Ngọc',0969712744,N'Khác','huydoan@gmail.com',N'36 điện biên phủ, quận 2')
GO

CREATE TABLE TOUR
(
	MATOUR VARCHAR(12) NOT NULL PRIMARY KEY,
	TENTOUR NVARCHAR(100) NOT NULL,
	GIATOUR INT NOT NULL CHECK (GIATOUR >0),
	NGAYDI DATE NOT NULL CHECK (NGAYDI >= GETDATE()),
	NGAYKETTHUC DATE NOT NULL,
	MOTA NVARCHAR(300),
	MALOAITOUR VARCHAR(12) NOT NULL,
	MADDEN VARCHAR(12) NOT NULL ,
	MADDI VARCHAR(12)NOT NULL ,
	--FOREIGN KEY(MADDEN) REFERENCES DIEMDEN(MADDEN),
	--FOREIGN KEY(MADDI) REFERENCES DIEMDI(MADDI),
)
-- covert NGAYDI,NGAYKETTHUC cua TOUR
GO
INSERT INTO TOUR(MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI)
VALUES('T01',N'Phú Quốc-Ngắm Hoàng Hôn Tại Sunset Sanato-Bãi Sao',2300000,'2023-10-10','2023-10-23',N'Phú Quốc là điểm nghỉ dưỡng, tham quan. Đến với Sunset Sanato Beach Club hòa cùng những bản nhạc sôi động, những góc ảnh check-in cực chất và thưởng ngoạn phong cảnh tuyệt đẹp hòa cùng ánh hoàng hôn rực rỡ đang dần dần buông xuống mặt biển bao la.','LT01','DDL01','DKH01')
INSERT INTO TOUR(MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI)
VALUES('T02',N'Đà Nẵng - Bà Nà - Cầu Vàng - Sơn Trà - Hội An',1500000,'2023-08-07','2023-08-17',N'Phố cổ Hội An với lung linh sắc màu của đèn lồng và những hoạt động dân gian đặc sắc Đại Nội Huế rộng lớn nơi hoàng cung xưa của các vua chúa Triều Nguyễn Động Phong Nha thuộc quần thể Di sản thiên nhiên Thế Giới.','LT01','DDL02','DKH02')
INSERT INTO TOUR(MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI)
VALUES('T03',N'Hà Nội - Hồ Hoàn Kiếm - Quốc Tử Giám',3100000,'2023-09-11','2023-09-18',N'Hà Nội nằm ở tả ngạn sông Đà và hai bên đồng bằng sông Hồng. Phía Bắc giáp với tỉnh Vĩnh Phúc và Thái Nguyên, phía Nam giáp tỉnh Hòa Bình, phía Đông giáp với tỉnh Bắc Ninh và Hưng Yên, còn phía Tây giáp tỉnh Vĩnh Phúc.','LT01','DDL03','DKH01')
INSERT INTO TOUR(MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI)
VALUES('T04',N'Vịnh Hạ Long - Đảo Tuần Châu - Động Thiên Cung',2550000,'2023-11-15','2023-11-20',N'Vịnh Hạ Long là một vịnh nhỏ thuộc phần bờ Tây vịnh Bắc Bộ tại khu vực biển Đông Bắc Việt Nam, bao gồm vùng biển đảo thuộc thành phố Hạ Long, thị xã Cẩm Phả và một phần của huyện đảo Vân Đồn.','LT01','DDL04','DKH02')
INSERT INTO TOUR(MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI)
VALUES('TN03',N'Du lịch Thái Lan Bangkok - Pattaya',5600000,'2023-10-13','2023-10-17',N'du khách thỏa sức ngắm cảnh trên biển Pattaya và chiêm ngưỡng vẻ đẹp lộng lẫy của toàn cảnh thành phố nhộn nhịp này, ngoài ra du khách có  thể chiêm bái, đốt pháo cầu phúc, cầu may để tỏ lòng tôn kính tại đài tưởng niệm của Đại Tướng Krom Luang Chumporn.','LT02','DDL05','DKH01')
INSERT INTO TOUR(MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI)
VALUES('TN04',N'Hàn Quốc - Seoul - Nami Everland',7500000,'2023-12-19','2023-12-26',N'Hàn Quốc là một điểm đến tuyệt vời, chúng ta đã khá quen thuộc về xứ sở Kim Chi qua những bộ phim nổi tiếng. Từ đó bạn cũng có thể hình dung ra một đất nước phát triển với những phong cảnh đẹp của xứ ôn đới.','LT02','DDL06','DKH02')
GO
select * from TOUR
CREATE TABLE LOAITOUR
(
	MALOAITOUR VARCHAR(12) NOT NULL PRIMARY KEY,
	TENLOAITOUR NVARCHAR(30) NOT NULL,	
)
GO
INSERT INTO LOAITOUR(MALOAITOUR,TENLOAITOUR)
VALUES('LT01',N'TOUR TRONG NƯỚC')
INSERT INTO LOAITOUR(MALOAITOUR,TENLOAITOUR)
VALUES('LT02',N'TOUR NGOÀI NƯỚC')
GO
CREATE TABLE DIEMDEN
(
	MADDEN VARCHAR(12) NOT NULL PRIMARY KEY,
	TENDDEN NVARCHAR(30) NOT NULL,
	MALOAITOUR VARCHAR(12) NOT NULL FOREIGN KEY REFERENCES LOAITOUR(MALOAITOUR),
)
GO
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL01',N'PHÚ QUỐC','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL02',N'ĐÀ NẴNG','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL03',N'HÀ NỘI','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL04',N'VỊNH HẠ LONG','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL05',N'BANGKOK','LT02')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL06',N'HÀN QUỐC','LT02')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL07',N'NHA TRANG','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL08',N'HUẾ','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL09',N'VŨNG TÀU','LT01')
INSERT INTO DIEMDEN(MADDEN,TENDDEN,MALOAITOUR)
VALUES('DDL10',N'SAPA','LT01')
GO
CREATE TABLE DIEMDI
(
	MADDI VARCHAR(12) NOT NULL PRIMARY KEY,
	TENDDI NVARCHAR(30) NOT NULL,
	MALOAITOUR VARCHAR(12) NOT NULL FOREIGN KEY REFERENCES LOAITOUR(MALOAITOUR),
)
select * from KHACHHANG
GO
INSERT INTO DIEMDI(MADDI,TENDDI,MALOAITOUR)
VALUES('DKH01',N'HỒ CHÍ MINH','LT01')
INSERT INTO DIEMDI(MADDI,TENDDI,MALOAITOUR)
VALUES('DKH02',N'HÀ NỘI','LT01')
GO
ALTER TABLE TOUR ADD CONSTRAINT fk01_TOUR FOREIGN KEY(MADDEN) REFERENCES DIEMDEN(MADDEN)
ALTER TABLE TOUR ADD CONSTRAINT fk02_TOUR FOREIGN KEY(MADDI) REFERENCES DIEMDI(MADDI)
ALTER TABLE TOUR ADD CONSTRAINT fk03_TOUR FOREIGN KEY(MALOAITOUR) REFERENCES LOAITOUR(MALOAITOUR)
GO
CREATE TABLE HOADON
(
	SOHD VARCHAR(12) NOT NULL PRIMARY KEY,
	NGAYLAP DATE NOT NULL,
	THANHTIEN INT NOT NULL,
	MATOUR VARCHAR(12) NOT NULL,
	MAKH VARCHAR(12) NOT NULL,
	MANV VARCHAR(12) NOT NULL,
	TRANGTHAI NVARCHAR(30) ,
)
GO
ALTER TABLE HOADON ADD CONSTRAINT fk01_HOADON FOREIGN KEY(MATOUR) REFERENCES TOUR(MATOUR)
ALTER TABLE HOADON ADD CONSTRAINT fk02_HOADON FOREIGN KEY(MAKH) REFERENCES KHACHHANG(MAKH)
ALTER TABLE HOADON ADD CONSTRAINT fk03_HOADON FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
--INSERT INTO NHANVIEN(MANV,TENNV,NGAYSINH,SDT,CCCD,NGAYVL)
--VALUES('NV04',N'D','2003-05-24',REPLICATE(0, 1)+CAST(0942617886 AS VARCHAR(12)),040203007518,'2023-02-01')
INSERT INTO HOADON(SOHD,NGAYLAP,THANHTIEN,MATOUR,MAKH,MANV,TRANGTHAI)
VALUES('HD01','2023-10-23',2300000,'T01','KH01','NV01',NULL)
INSERT INTO HOADON(SOHD,NGAYLAP,THANHTIEN,MATOUR,MAKH,MANV,TRANGTHAI)
VALUES('HD02','2023-08-17',1500000,'T02','KH02','NV02',NULL)
INSERT INTO HOADON(SOHD,NGAYLAP,THANHTIEN,MATOUR,MAKH,MANV,TRANGTHAI)
VALUES('HD03','2023-10-13',5600000,'TN03','KH03','NV03',NULL)
------------------------------------------------------------------------------------------------------------

-- convert ngaysinh,gioitinh,ngayvl cua NHANVIEN
CREATE PROCEDURE SELECTALLNHANVIEN
	@tukhoa NVARCHAR(40)--- tìm kiếm nhân viên dựa vào từ khóa
	-- 1: tìm theo mã
	-- 2: tìm theo ten,.... 
	--3: tìm theo sdt
	--loại tìm kiếm tương đối
AS
	SELECT MANV,
	TENNV,
		CONVERT (VARCHAR(11),NGAYSINH,103) AS [NGAYSINH],
	GIOITINH,
	SDT,
	CCCD,
	CONVERT (VARCHAR(11),NGAYVL,103) AS [NGAYVL]
	FROM NHANVIEN 
	WHERE LOWER(MANV) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENNV) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	GIOITINH LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	NGAYSINH LIKE '%' + TRIM(@tukhoa) + '%'
	OR	SDT LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	CCCD LIKE '%' + TRIM(@tukhoa) + '%'
	OR	NGAYVL LIKE '%' + TRIM(@tukhoa) + '%'
GO
drop procedure SELECTALLNHANVIEN
EXEC SELECTALLNHANVIEN  nữ
select * from NHANVIEN
SELECTALLNHANVIEN ''
DROP PROCEDURE SELECTALLNHANVIEN
------------- TẠO PROCEDURE THÊM NHÂN VIÊN
CREATE PROCEDURE THEMMOINHANVIEN
	@MANV VARCHAR(12) ,
	@TENNV NVARCHAR(32),
	@NGAYSINH DATE ,
	@GIOITINH NVARCHAR(6) ,
	@SDT BIGINT ,
	@CCCD BIGINT ,
	@NGAYVL DATE 
AS
BEGIN
	INSERT INTO NHANVIEN
	(
	MANV,TENNV,NGAYSINH,GIOITINH,SDT,CCCD,NGAYVL
	)VALUES(
	@MANV,@TENNV,@NGAYSINH ,@GIOITINH ,@SDT,@CCCD,@NGAYVL
	);
	IF @@ROWCOUNT > 0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
END
EXEC THEMMOINHANVIEN 'NV04',N'Hoàng Xuân Vinh','2002-04-23',N'Nam',0947757666,040203001331,'2023-09-04'
EXEC THEMMOINHANVIEN 'NV05',N'Đào Tuấn Dũng','2002-07-13',N'khác',0947757666,040203001331,'2023-04-12' 

 select * from NHANVIEN
 DROP PROCEDURE THEMMOINHANVIEN
 ------- SỬA THOONG TIN NHÂN VIÊN
 CREATE PROCEDURE UPDATENHANVIEN
	@MANV VARCHAR(12) ,
	@TENNV NVARCHAR(32),
	@NGAYSINH DATE ,
	@GIOITINH NVARCHAR(6),
	@SDT BIGINT ,
	@CCCD BIGINT ,
	@NGAYVL DATE
AS
BEGIN  
	UPDATE NHANVIEN
	SET 
		--MANV= @MANV,
		TENNV = @TENNV,
		NGAYSINH= @NGAYSINH,
		GIOITINH = @GIOITINH,
		SDT = @SDT,
		CCCD= @CCCD,
		NGAYVL = @NGAYVL
		WHERE MANV = @MANV		
	IF @@ROWCOUNT >0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;	
END
go
/*
begin try
	EXEC UPDATENHANVIEN	'NV04',N'Hoàng Xuân Vinh','2002-04-23',N'Khác','ưkeorjqt',040203001331,'2023-09-24' 
end try
begin catch
	print(N'Lỗi nhập sđt hoặc cccd không được chứa ký tự');
end catch
*/
EXEC UPDATENHANVIEN	'NV04',N'Hoàng Xuân Vinh','2002-04-23',N'Khác','ưkeorjqt',040203001331,'2023-09-24'
DROP PROC UPDATENHANVIEN
select * from NHANVIEN
--------- TẠO PROCEDURE SELECT THÔNG TIN CHI TIẾT CỦA 1 NHÂN VIÊN
CREATE PROCEDURE SELECTNV
	@MANV VARCHAR(12)
AS
BEGIN 
	SELECT MANV,
	TENNV,
		CONVERT (VARCHAR(11),NGAYSINH,103) AS [NGAYSINH],
	GIOITINH,
	SDT,
	CCCD,
	CONVERT (VARCHAR(11),NGAYVL,103) AS [NGAYVL]
		FROM NHANVIEN
		WHERE MANV = @MANV;
END
SELECT * FROM NHANVIEN
EXEC SELECTNV 'NV04'
drop procedure SELECTNV
-------- xóa nhân viên---------------------------------------
--------------------------------------------------------------------
CREATE PROCEDURE DELETE1NV
	 @MANV VARCHAR(12)
AS
BEGIN 
	DELETE from NHANVIEN
	WHERE MANV = @MANV
END
EXEC DELETE1NV 'NV07'
drop proc DELETE1NV
EXEC THEMMOINHANVIEN 'NV06',N'Phạm Như Quỳnh','2002-05-13',N'Nữ',0947757666,040203001331,'2023-04-12' 
select * from NHANVIEN
-----------------------------------------------------------------------------------------------------------------
GO
/****** Object:  StoredProcedure [dbo].[DELETEKH]    Script Date: 7/22/2023 4:03:31 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROC [dbo].[DELETE1NV]
	@MANV VARCHAR(12)
AS
BEGIN
	BEGIN TRY
	DELETE FROM HOADON WHERE MANV= @MANV;
	DELETE FROM NHANVIEN WHERE MANV = @MANV;
	RETURN 1;
	END TRY
	BEGIN CATCH 
	RETURN 0;
	END CATCH

end
------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------
--------------- SELECT ALL KHÁCH HÀNG--MAKH TENKH SDT GIOITINH EMAIL DIA CHI
CREATE PROCEDURE SELECTALLKHACHHANG
	@tukhoa nvarchar(40)
AS
	SELECT MAKH,
	TENKH,
		SDT,
	GIOITINH,
	EMAIL,
	DIACHI
	FROM KHACHHANG
	WHERE LOWER(MAKH) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENKH) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	GIOITINH LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	SDT LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	EMAIL LIKE '%' + TRIM(@tukhoa) + '%'
	OR	DIACHI LIKE '%' + TRIM(@tukhoa) + '%'
GO;
EXEC SELECTALLKHACHHANG ''
DROP PROC SELECTALLKHACHHANG
SELECT * FROM KHACHHANG
------------ THEEM KHACH HANG
CREATE PROCEDURE THEMMOIKHACHHANG
	@MAKH VARCHAR(12) ,
	@TENKH NVARCHAR(32),
	@SDT BIGINT ,
	@GIOITINH NVARCHAR(6) ,
	@EMAIL VARCHAR(30) ,
	@DIACHI NVARCHAR(50) 
AS
BEGIN
	INSERT INTO KHACHHANG
	(
	MAKH,TENKH,SDT,GIOITINH,EMAIL,DIACHI
	)VALUES(
	@MAKH,@TENKH,@SDT ,@GIOITINH ,@EMAIL,@DIACHI
	);
	IF @@ROWCOUNT > 0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
END
EXEC THEMMOIKHACHHANG 'KH04',N'Trương Lưu Khải',0969734543,N'Nam','truongluukhai@gmail.com',N'đường Hồ Hoàn Hải, số 130, Phường Phan Bội Châu'
EXEC THEMMOIKHACHHANG 'KH05',N'Võ Thị Sáu',0817557666,N'Nữ','vothisau@gmail.com',N'đường Phan Chu Trinh, số 121, Phường Phan Bội Châu'
EXEC THEMMOIKHACHHANG 'KH06',N'Doãn Hoàng Huy',0817557446,N'Nam','doanhoanghuyvipro@gmail.com',N'đường Phan Chu Trinh, số 121, Phường Phan Bội Châu'
EXEC THEMMOIKHACHHANG 'KH23',N'Doãn Hoàng Huy',0817557446,N'Nam','doanhoanghuyvipro@gmail.com',N'đường Phan Chu Trinh, số 121, Phường Phan Bội Châu'
EXEC THEMMOIKHACHHANG 'KH24',N'Doãn Hoàng Huy',0817557446,N'Nam','doanhoanghuyvipro@gmail.com',N'đường Phan Chu Trinh, số 121, Phường Phan Bội Châu'
EXEC THEMMOIKHACHHANG 'KH28',N'Doãn Hoàng Huy',0817557446,N'Nam','doanhoanghuyvipro@gmail.com',N'đường Phan Chu Trinh, số 121, Phường Phan Bội Châu'

select * from KHACHHANG
DROP PROC THEMMOIKHACHHANG
--------------------- UPDATE KHACSH HANG
CREATE PROCEDURE UPDATEKHACHHANG
	@MAKH VARCHAR(12) ,
	@TENKH NVARCHAR(32),
	@SDT BIGINT ,
	@GIOITINH NVARCHAR(6) ,
	@EMAIL VARCHAR(30) ,
	@DIACHI NVARCHAR(50)
AS
BEGIN 
	UPDATE KHACHHANG
	SET 
		--MANV= @MANV,
		TENKH = @TENKH,
		SDT= @SDT,
		GIOITINH = @GIOITINH,
		EMAIL = @EMAIL,
		DIACHI= @DIACHI
		WHERE MAKH = @MAKH
	IF @@ROWCOUNT >0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
END
EXEC UPDATEKHACHHANG 'KH01',N'Trần Ngyuễn Nhật Tân',0969712443,N'Nam','tayhovippro@gmail.com',N'đường trần duy hưng, ngõ 37'
DROP PROC UPDATEKHACHHANG
SELECT * FROM KHACHHANG
--------- TẠO PROCEDURE SELECT THÔNG TIN CHI TIẾT CỦA 1 khách hàng
CREATE PROCEDURE SELECTKH
	@MAKH VARCHAR(12)
AS
BEGIN 
	SELECT MAKH,
	TENKH,
	SDT,
	GIOITINH,
	EMAIL,
	DIACHI
		FROM KHACHHANG
		WHERE MAKH = @MAKH;
END
EXEC SELECTKH 'KH01'
drop procedure SELECTKH
--- xóa 1 khách hàng-nhưng chỉ xóa được khách hàng chưa có hóa đơn

CREATE PROC DELETEKH
	@MAKH VARCHAR(12)
AS
BEGIN
	DELETE FROM KHACHHANG WHERE MAKH = @MAKH
	IF @@ROWCOUNT >0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
end
------------------------------
GO
/****** Object:  StoredProcedure [dbo].[DELETEKH]    Script Date: 7/22/2023 4:03:31 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER PROC [dbo].[DELETEKH]
	@MAKH VARCHAR(12)
AS
BEGIN
	BEGIN TRY
	DELETE FROM HOADON WHERE MAKH= @MAKH;
	DELETE FROM KHACHHANG WHERE MAKH = @MAKH;
	RETURN 1;
	END TRY
	BEGIN CATCH 
	RETURN 0;
	END CATCH

end
--------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------
--------------------------------------------------------------------------------------------------------------------------------
------------------------ SELECT TAT CA TOUR-------------------------------
CREATE PROC SELECTALLTOUR
	@tukhoa NVARCHAR(50)
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
	FROM TOUR
	WHERE LOWER(MATOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENTOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(NGAYDI) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(NGAYKETTHUC) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	MOTA LIKE '%' + TRIM(@tukhoa) + '%'
	OR	LOWER(MALOAITOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(MADDEN) LIKE '%' + TRIM(@tukhoa) + '%'
	OR	LOWER(MADDI) LIKE '%' + TRIM(@tukhoa) + '%'
EXEC SELECTALLTOUR ''
DROP PROC SELECTALLTOUR
SELECT * FROM TOUR
---------------- select all tour không hiển thị mô tả loại tour điểm đi và điểm đến
CREATE PROC SELECTALLDATTOUR
	@tukhoa NVARCHAR(50)
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
		MOTA
	FROM TOUR
	WHERE LOWER(MATOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENTOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(NGAYDI) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(NGAYKETTHUC) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
EXEC SELECTALLDATTOUR ''
DROP PROC SELECTALLDATTOUR
SELECT * FROM TOUR
--------------------------- THEM tour --------------------
CREATE PROCEDURE THEMMOITOUR
	@MATOUR VARCHAR(12) ,
	@TENTOUR NVARCHAR(100) ,
	@GIATOUR INT ,
	@NGAYDI DATE ,
	@NGAYKETTHUC DATE,
	@MOTA NVARCHAR(300),
	@MALOAITOUR VARCHAR(12) ,
	@MADDEN VARCHAR(12)  ,
	@MADDI VARCHAR(12) 
AS
BEGIN
	INSERT INTO TOUR
	(
	MATOUR,TENTOUR,GIATOUR,NGAYDI,NGAYKETTHUC,MOTA,MALOAITOUR,MADDEN,MADDI
	)VALUES(
	@MATOUR,@TENTOUR,@GIATOUR,@NGAYDI,@NGAYKETTHUC,@MOTA,@MALOAITOUR,@MADDEN,@MADDI
	);
	IF @@ROWCOUNT > 0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
END
EXEC THEMMOITOUR 'T05',N'SAPA-CAT BA-DINH PHANSEPANG',6550000,'2023-11-17','2023-11-22',
N'Vịnh Hạ Long là một vịnh nhỏ thuộc phần bờ Tây vịnh Bắc Bộ tại khu vực biển Đông Bắc Việt Nam, bao gồm vùng biển đảo thuộc thành phố Hạ Long, thị xã Cẩm Phả và một phần của huyện đảo Vân Đồn.',
'LT01','DDL04','DKH02'
EXEC THEMMOITOUR 'T06',N'Vũng Tàu- Bãi Dâu- Chùa Hộ Pháp',11550000,'2023-08-17','2023-08-22',
N' Vũng Tàu từ lâu đã được xem là một điểm đến du lịch hấp dẫn, bởi những vẻ đẹp tự nhiên và khoảng cách địa lý thích hợp. Vũng Tàu chỉ cách trung tâm Thành phố Hồ Chí Minh 100km về hướng Đông Nam, Phía Đông giáp huyện Long Điền, Phía Tây giáp vịnh Gành Rái,',
'LT01','DDL09','DKH01'
EXEC THEMMOITOUR 'T07',N'Huế- Triều Đình Huế- Chùa Thiên Mụ',5400000,'2023-09-01','2023-09-11',
N' Tour tham quan Huế đem lại nhiều trải nghiệm thú vị. Tìm hiểu về lịch sử dưới 13 triều đại phong kiến tại Đại Nội Huế. các lăng mộ của Minh Mạng – Khải Định . ',
'LT01','DDL08','DKH01'

select * from TOUR
DROP PROC THEMMOITOUR
---------------------- cap nhật tour ---------------------- 
CREATE PROCEDURE UPDATETOUR
	@MATOUR VARCHAR(12) ,
	@TENTOUR NVARCHAR(100) ,
	@GIATOUR INT ,
	@NGAYDI DATE ,
	@NGAYKETTHUC DATE,
	@MOTA NVARCHAR(300),
	@MALOAITOUR VARCHAR(12) ,
	@MADDEN VARCHAR(12)  ,
	@MADDI VARCHAR(12) 
AS
BEGIN 
	UPDATE TOUR
	SET 
		--MANV= @MANV,
		MATOUR = @MATOUR,
		TENTOUR= @TENTOUR,
		GIATOUR = @GIATOUR,
		NGAYDI = @NGAYDI,
		NGAYKETTHUC= @NGAYKETTHUC,
		MOTA = @MOTA,
		MALOAITOUR= @MALOAITOUR,
		MADDEN = @MADDEN,
		MADDI= @MADDI
		WHERE MATOUR = @MATOUR
	IF @@ROWCOUNT >0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
END
EXEC UPDATETOUR 'T05',N'SAPA-RI CAT DO-DINH PHANSEPANG',6550000,'2023-11-17','2023-11-22',
N'Du lịch Sapa - "Thành phố trong sương" nổi tiếng với với cảnh quan núi non hùng vĩ, khí hậu trong lành hoang sơ, quanh năm mát mẻ sẽ giúp bạn có được những giờ phút nghỉ dưỡng đúng nghĩa.',
'LT01','DDL04','DKH02'
-------- SELECT 1 TOUR ----------------------
CREATE PROCEDURE SELECT1TOUR
	@MATOUR VARCHAR(12)
AS
BEGIN 
	SELECT MATOUR,
	TENTOUR,
	GIATOUR,
	CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
	CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
		FROM TOUR
		WHERE MATOUR = @MATOUR;
END
EXEC SELECT1TOUR 'TN03'
------ test
CREATE PROCEDURE SELECT1TOURFORMDATTOUR
	@MATOUR VARCHAR(12)
AS
SELECT MATOUR,
	TENTOUR,
	GIATOUR,
	CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
	CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	LOAITOUR.TENLOAITOUR,
	DIEMDEN.TENDDEN,
	DIEMDI.TENDDI
		FROM TOUR ,DIEMDEN, DIEMDI, LOAITOUR
		WHERE MATOUR = @MATOUR AND TOUR.MADDEN = DIEMDEN.MADDEN 
		AND TOUR.MADDI = DIEMDI.MADDI AND TOUR.MALOAITOUR= LOAITOUR.MALOAITOUR

EXEC SELECT1TOURFORMDATTOUR 'TN03'
---------
------------XOA 1 TOUR--------------
CREATE PROC DELETETOUR
	@MATOUR VARCHAR(12)
AS
BEGIN
	BEGIN TRY
	DELETE FROM HOADON WHERE MATOUR= @MATOUR;
	DELETE FROM TOUR WHERE MATOUR = @MATOUR;
	RETURN 1;
	END TRY
	BEGIN CATCH 
	RETURN 0;
	END CATCH
end
-----------select all maloaitour
CREATE PROC SELECTALLMALOAITOUR
	@tukhoa NVARCHAR(50)
AS
	SELECT MALOAITOUR ,
	TENLOAITOUR  
	FROM LOAITOUR
	WHERE LOWER(MALOAITOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENLOAITOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'

EXEC SELECTALLMALOAITOUR ''
------------ SELECT ALL DIEM DEN
CREATE PROC SELECTALLMADIEMDEN
	@tukhoa NVARCHAR(50)
AS
	SELECT MADDEN ,
	TENDDEN,
	MALOAITOUR
	FROM DIEMDEN
	WHERE LOWER(MADDEN) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENDDEN) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(MALOAITOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'

EXEC SELECTALLMADIEMDEN ''
SELECT * FROM DIEMDEN
------------- SELECT ALL DIEM DI
CREATE PROC SELECTALLMADIEMDI
	@tukhoa NVARCHAR(50)
AS
	SELECT MADDI ,
	TENDDI,
	MALOAITOUR
	FROM DIEMDI
	WHERE LOWER(MADDI) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TENDDI) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(MALOAITOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'

EXEC SELECTALLMADIEMDI ''
--------------- SELECT 1 MALOAITOUR
CREATE PROC SELECT1MALOAITOUR
	@MALOAITOUR nvarchar(50)
as
BEGIN
	SELECT MALOAITOUR,
	TENLOAITOUR
	FROM LOAITOUR
	WHERE MALOAITOUR = @MALOAITOUR
END
--------------------------------------
------------- lọc button trong nước-----
CREATE PROC SELECTLOCLOAITOUR
	@MALOAITOUR NVARCHAR(50)
AS
BEGIN
	SELECT MATOUR,TENTOUR,GIATOUR,
	CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
	CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
	FROM TOUR
	WHERE MALOAITOUR = @MALOAITOUR
END
EXEC SELECTLOCLOAITOUR  'LT02'
------------------------------------------
----locj loại tour trong form đặt tour ko có mô tả...
CREATE PROC SELECTLOCLOAIDATTOUR
	@MALOAITOUR NVARCHAR(50)
AS
BEGIN
	SELECT MATOUR,TENTOUR,GIATOUR,
	CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
	CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA
	FROM TOUR
	WHERE MALOAITOUR = @MALOAITOUR
END
EXEC SELECTLOCLOAIDATTOUR  'LT02'
drop proc SELECTLOCLOAIDATTOUR
select * from KHACHHANG
------------ lọc button ngoài nước
------   MAT KHAU----------------
select * from NHANVIEN


CREATE TABLE TAIKHOAN
(	
	LOAITAIKHOAN VARCHAR(20),
	TAIKHOAN VARCHAR(50),
	MATKHAU VARCHAR(50)
)
INSERT INTO TAIKHOAN(LOAITAIKHOAN,TAIKHOAN,MATKHAU) VALUES ('admin','admin','admin')
INSERT INTO TAIKHOAN(LOAITAIKHOAN,TAIKHOAN,MATKHAU) VALUES ('nhanvien','NV01','123456')
delete from TAIKHOAN where MATKHAU = '123456'
UPDATE KHACHHANG SET MATKHAU ='1234'
UPDATE NHANVIEN SET MATKHAU ='123456'
SELECT * FROM NHANVIEN 
ALTER TABLE KHACHHANG ADD MATKHAU VARCHAR(50) DEFAULT '123456'
ALTER TABLE NHANVIEN ADD MATKHAU VARCHAR(50) DEFAULT '123456'

DROP TABLE TAIKHOAN
SELECT * FROM KHACHHANG
------------------------------------------------------------------------------------------------
----------------------------------------------------------------
----------------------------------------------------------------
----------------------------------------------------------------
----------------------------------------------------------------
------------ PROC DANG NHAP

CREATE PROC DANGNHAP
	@LOAITAIKHOAN VARCHAR(20),
	@TAIKHOAN VARCHAR(50),
	@MATKHAU VARCHAR(50)
AS
BEGIN
	IF  @LOAITAIKHOAN = 'admin'
			SELECT * FROM TAIKHOAN 
			WHERE TAIKHOAN = @TAIKHOAN AND MATKHAU = @MATKHAU
	ELSE IF
		@LOAITAIKHOAN = 'nhanvien' 
			SELECT * FROM NHANVIEN
			WHERE MANV = @TAIKHOAN AND MATKHAU = @MATKHAU
	ELSE 
			SELECT * FROM KHACHHANG 
			WHERE MAKH = @TAIKHOAN AND MATKHAU = @MATKHAU
	
END
EXEC DANGNHAP 'khachhang','KH01','1234'
DROP PROC DANGNHAP

------ đăng ký tài khoản cho nhân viên 
Create proc DANGKYTAIKHOAN
@LOAITAIKHOAN VARCHAR(20),
@TAIKHOAN VARCHAR(20),
@MATKHAUDK VARCHAR(20)
as
begin
if @LOAITAIKHOAN ='nhanvien'
	begin
    	if exists (select * from NhanVien where MANV = @TAIKHOAN)
    	begin
        	update NhanVien set MATKHAU = @MATKHAUDK where MANV = @TAIKHOAN        	
		END
	end
if @LOAITAIKHOAN = 'admin'
	begin 
		if exists (select * from TAIKHOAN where TAIKHOAN = @TAIKHOAN)
		begin
        	update TAIKHOAN set MATKHAU = @MATKHAUDK where TAIKHOAN = @TAIKHOAN        	
		END
	end
end
SELECT * FROM NHANVIEN
EXEC DANGKYTAIKHOAN 'nhanvien','iwqeuriwqer','123456'
DROP PROC DANGKYTAIKHOAN
------------------------------- đổi mk
Create proc DOIMATKHAU
@LOAITAIKHOAN VARCHAR(20),
@TAIKHOAN VARCHAR(20),
@OldPass VARCHAR(30),
@NewPass VARCHAR(30)
as
begin
if @LOAITAIKHOAN ='nhanvien'
	begin
    	if exists (select * from NhanVien where MANV = @TAIKHOAN and MATKHAU = @OldPass)
    	begin
        	update NhanVien set MATKHAU = @NewPass where MANV = @TAIKHOAN
        	select 1 as code, N'Thay doi mat khau thanh cong !!' as MSG
   	 	end
    	else
        	select 0 as code, N'Tai khoan hoac mat khau sai !!' as MSG
	end
if @LOAITAIKHOAN = 'admin'
	begin 
		if exists (select * from TAIKHOAN where TAIKHOAN = @TAIKHOAN and MATKHAU = @OldPass)
		begin
        	update TAIKHOAN set MATKHAU = @NewPass where TAIKHOAN = @TAIKHOAN
        	select 1 as code, N'Thay doi mat khau thanh cong !!' as MSG
   	 	end
    	else
        	select 0 as code, N'Tai khoan hoac mat khau sai !!' as MSG
	end
end
EXEC DOIMATKHAU 'nhanvien','NV0123','123456','nhanvien1'
select * from NHANVIEN
---------------TAI KHOAN NHAN VIEN
select * from NHANVIEN
select * from TAIKHOAN
select * from KHACHHANG

------------------------------------------------------------------------------------------------
------------------------------------------------------------------------------------------------
----------------------------------------------------------------
--------------------------- HOA DON---------------
---------- SELECT ALL HOA DON--
CREATE PROCEDURE SELECTALLHOADON
	@tukhoa NVARCHAR(50)
AS
	SELECT SOHD,
	CONVERT (VARCHAR(11),NGAYLAP,103) AS [NGÀY LẬP],
	THANHTIEN,MATOUR,MAKH,MANV,TRANGTHAI
	FROM HOADON
	WHERE LOWER(SOHD) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(NGAYLAP) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(THANHTIEN) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(MATOUR) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(MAKH) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(MANV) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
	OR	LOWER(TRANGTHAI) LIKE '%' + LOWER(TRIM(@tukhoa)) + '%'
EXEC SELECTALLHOADON HD01
DROP PROC SELECTALLHOADON
------------- select 1 HOADON
CREATE PROC SELECT1HOADON
	@SOHD VARCHAR(12)
	AS 
	BEGIN
		SELECT SOHD,
		CONVERT (VARCHAR(11),NGAYLAP,103) AS [NGAYLAP],
		THANHTIEN,
		MATOUR,
		MAKH,
		MANV,
		TRANGTHAI
		FROM HOADON
		WHERE SOHD = @SOHD
	END
EXEC SELECT1HOADON 'HD01'
drop proc SELECT1HOADON
-----------  SELECT UPDATE HOADON----
CREATE PROC UPDATEHOADON
	@SOHD VARCHAR(12),
	@NGAYLAP DATE,
	@THANHTIEN INT ,
	@MATOUR VARCHAR(12) ,
	@MAKH VARCHAR(12),
	@MANV VARCHAR(12),
	@TRANGTHAI NVARCHAR(30) 
	AS
	BEGIN 
		UPDATE HOADON
	SET 
		--MANV= @MANV,
		NGAYLAP= @NGAYLAP,
		THANHTIEN = @THANHTIEN,
		MATOUR = @MATOUR,
		MAKH= @MAKH,
		MANV = @MANV,
		TRANGTHAI= @TRANGTHAI
		WHERE SOHD = @SOHD
	IF @@ROWCOUNT >0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
	END
	EXEC UPDATEHOADON 'HD03','2023-10-14',5600000,'TN03','KH03','NV03',NULL
	SELECT * FROM HOADON
	SELECT * FROM NHANVIEN
	SELECT * FROM KHACHHANG
	SELECT * FROM TOUR 
	SELECT * FROM TAIKHOAN
------- THEM HOADON-----
CREATE PROC THEMHOADON
	@SOHD VARCHAR(12),
	@NGAYLAP DATE,
	@THANHTIEN INT ,
	@MATOUR VARCHAR(12) ,
	@MAKH VARCHAR(12),
	@MANV VARCHAR(12),
	@TRANGTHAI NVARCHAR(30) 
	AS
	BEGIN
		INSERT INTO HOADON(SOHD,NGAYLAP,THANHTIEN,MATOUR,MAKH,MANV,TRANGTHAI)
		VALUES (@SOHD,@NGAYLAP,@THANHTIEN,@MATOUR,@MAKH,@MANV,@TRANGTHAI);
		IF @@ROWCOUNT > 0 BEGIN RETURN 1 END
	ELSE BEGIN RETURN 0 END;
	END
EXEC THEMHOADON 'HD04','2023-10-1',2550000,'T04','KH04','NV04',NULL
DELETE FROM HOADON WHERE SOHD= 'HD04'
SELECT * FROM HOADON
----------- DELETE 1 HOADON
CREATE PROC DELETEHOADON
	@SOHD VARCHAR(12)
AS
BEGIN
	BEGIN TRY
	DELETE FROM HOADON WHERE SOHD= @SOHD;
	RETURN 1;
	END TRY
	BEGIN CATCH 
	RETURN 0;
	END CATCH
END
EXEC DELETEHOADON 'HD04'
--------------------------------------------------------------------------------------------------------------------------------
---------------------- dang ky tour-----
------------------- tra cuu nhan vien ---
CREATE PROC SELECTALLNHANHVIENTRACUU
	@tukhoa1 varchar(12),
	@tukhoa2 nvarchar(32),
	@tukhoa3 nvarchar(15),
	@tukhoa4 NVARCHAR(6),
	@tukhoa5 varchar(13),
	@tukhoa6 VARCHAR(13),
	@tukhoa7 nvarchar(15)
AS 
	SELECT MANV,
	TENNV,
		CONVERT (VARCHAR(11),NGAYSINH,103) AS [NGAYSINH],
	GIOITINH,
	SDT,
	CCCD,
	CONVERT (VARCHAR(11),NGAYVL,103) AS [NGAYVL]
	FROM NHANVIEN 
	WHERE LOWER(MANV) LIKE '%' + LOWER(TRIM(@tukhoa1)) + '%'
	and	LOWER(TENNV) LIKE '%' + LOWER(TRIM(@tukhoa2)) + '%'
	and	NGAYSINH LIKE '%' + LOWER(TRIM(@tukhoa3)) + '%'
	and	GIOITINH LIKE '%' + LOWER(TRIM(@tukhoa4)) + '%'
	and	SDT LIKE '%' + TRIM(@tukhoa5) + '%'
	and	CCCD LIKE '%' + TRIM(@tukhoa6) + '%'
	and	NGAYVL LIKE '%' + TRIM(@tukhoa7) + '%'
EXEC SELECTALLNHANHVIENTRACUU '','','2002-05-13','','','',''
EXEC THEMMOINHANVIEN 'NV06',N'Phạm Như Quỳnh','2002-05-13',N'Nữ',0947757666,040203001331,'2023-04-12' 

select * from NHANVIEN
drop proc SELECTALLNHANHVIENTRACUU

	drop PROC SELECTALLNHANCUU
----------------------------------------------------
--------------------------------
--------------------------------
--------------------------------
--------------------------------
--------------------------------
-------- tra cứu khách hàng-----

CREATE PROCEDURE SELECTALLKHACHHANGTRACUU
	@MAKH VARCHAR(12),
	@TENKH NVARCHAR(32) ,
	@SDT VARCHAR(13) ,
	@GIOITINH NVARCHAR(6) ,
	@EMAIL VARCHAR(30) ,
	@DIACHI NVARCHAR(50) 
AS
	SELECT MAKH,
	TENKH,
	SDT,
	GIOITINH,
	EMAIL,
	DIACHI
	FROM KHACHHANG
	WHERE LOWER(MAKH) LIKE '%' + LOWER(TRIM(@MAKH)) + '%'
	AND	LOWER(TENKH) LIKE '%' + LOWER(TRIM(@TENKH)) + '%'
	AND	SDT LIKE '%' + TRIM(@SDT) + '%'
	AND	GIOITINH LIKE '%' + LOWER(TRIM(@GIOITINH)) + '%'	
	AND	EMAIL LIKE '%' + trim(@EMAIL) + '%'
	AND	DIACHI LIKE '%' + TRIM(@DIACHI) + '%'
EXEC SELECTALLKHACHHANGTRACUU '','','',khác,'',''
EXEC SELECTALLKHACHHANGTRACUU '','','','','',''
DROP PROC SELECTALLKHACHHANGTRACUU
---------------- tra cứu theo đúng ký tự nhập vào ----
CREATE PROCEDURE SELECTALLKHACHHANGTRACUUDUNGKYTU
	@MAKH VARCHAR(12),
	@TENKH NVARCHAR(32) ,
	@SDT VARCHAR(13) ,
	@GIOITINH NVARCHAR(6) ,
	@EMAIL VARCHAR(30) ,
	@DIACHI NVARCHAR(50) 
AS
	SELECT MAKH,
	TENKH,
	SDT,
	GIOITINH,
	EMAIL,
	DIACHI
	FROM KHACHHANG
	WHERE (MAKH) LIKE TRIM(@MAKH)
	AND	(TENKH) LIKE TRIM(@TENKH)
	AND	SDT LIKE  TRIM(@SDT) 
	AND	GIOITINH LIKE TRIM(@GIOITINH)	
	AND	EMAIL LIKE  TRIM(@EMAIL)
	AND	DIACHI LIKE TRIM(@DIACHI)
EXEC SELECTALLKHACHHANGTRACUUDUNGKYTU KH05,N'Võ Thị Sáu',817557666,Nữ,'vothisau@gmail.com',N'đường Phan Chu Trinh, số 121, Phường Phan Bội Châu'
EXEC SELECTALLKHACHHANGTRACUUDUNGKYTU '','','','','',''
drop proc SELECTALLKHACHHANGTRACUUDUNGKYTU
select * from KHACHHANG
----------- tra cứu tour ------
CREATE PROC SELECTALLTOURTRACUU
	@MATOUR VARCHAR(12) ,
	@TENTOUR NVARCHAR(100) ,
	@GIATOUR VARCHAR(13),
	@NGAYDI VARCHAR(13),
	@NGAYKETTHUC VARCHAR(13),
	@MOTA NVARCHAR(300),
	@MALOAITOUR VARCHAR(12),
	@MADDEN VARCHAR(12),
	@MADDI VARCHAR(12) 
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
	FROM TOUR
	WHERE LOWER(MATOUR) LIKE '%' + LOWER(TRIM(@MATOUR)) + '%'
	AND	LOWER(TENTOUR) LIKE '%' + LOWER(TRIM(@TENTOUR)) + '%'
	AND	LOWER(GIATOUR) LIKE '%' + LOWER(TRIM(@GIATOUR)) + '%'
	--AND NGAYDI = @NGAYDI
	AND	LOWER(NGAYDI) LIKE '%' + LOWER(TRIM(@NGAYDI)) + '%' 
	AND	LOWER(NGAYKETTHUC) LIKE '%' + LOWER(TRIM(@NGAYKETTHUC)) + '%'
	AND	LOWER(MOTA) LIKE '%' + LOWER(TRIM(@MOTA)) + '%'
	AND	LOWER(MALOAITOUR) LIKE '%' + LOWER(TRIM(@MALOAITOUR)) + '%'
	AND	LOWER(MADDEN) LIKE '%' + LOWER(TRIM(@MADDEN)) + '%'
	AND	LOWER(MADDI) LIKE '%' + LOWER(TRIM(@MADDI)) + '%'
EXEC  SELECTALLTOURTRACUU '','','','2023-10-10','','','','',''
DROP PROC SELECTALLTOURTRACUU
------------------- lọc đặt tour -------------- theo ...
CREATE PROC SELECTALLTOURLOCDATTOUR
	
	--@NGAYKETTHUC VARCHAR(13),
	@MADDEN VARCHAR(12),
	@MADDI VARCHAR(12) ,
	@NGAYDI VARCHAR(13),
	@NGAYKETTHUC VARCHAR(13)
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC]

	FROM TOUR
	WHERE LOWER(NGAYDI) LIKE '%' + LOWER(TRIM(@NGAYDI)) + '%' 
	AND	LOWER(NGAYKETTHUC) LIKE '%' + LOWER(TRIM(@NGAYKETTHUC)) + '%'
	AND	LOWER(MADDEN) LIKE '%' + LOWER(TRIM(@MADDEN)) + '%'
	AND	LOWER(MADDI) LIKE '%' + LOWER(TRIM(@MADDI)) + '%'
EXEC  SELECTALLTOURLOCDATTOUR '','','2023-10-10',''
drop proc SELECTALLTOURLOCDATTOUR
------ tra cứu hóa đơn ---
CREATE PROCEDURE SELECTALLHOADONTRACUU
	@SOHD VARCHAR(12),
	@NGAYLAP VARCHAR(15),
	@THANHTIEN VARCHAR(15),
	@MATOUR VARCHAR(12),
	@MAKH VARCHAR(12),
	@MANV VARCHAR(12)
	--@TRANGTHAI NVARCHAR(30)
AS
	SELECT SOHD,
	CONVERT (VARCHAR(11),NGAYLAP,103) AS [NGÀY LẬP],
	THANHTIEN,MATOUR,MAKH,MAKH,TRANGTHAI
	FROM HOADON
	WHERE LOWER(SOHD) LIKE '%' + LOWER(TRIM(@SOHD)) + '%'
	AND	LOWER(NGAYLAP) LIKE '%' + LOWER(TRIM(@NGAYLAP)) + '%'
	AND	LOWER(THANHTIEN) LIKE '%' + TRIM(@THANHTIEN) + '%'
	AND	LOWER(MATOUR) LIKE '%' + LOWER(TRIM(@MATOUR)) + '%'
	AND	LOWER(MAKH) LIKE '%' + LOWER(TRIM(@MAKH)) + '%'
	AND	LOWER(MANV) LIKE '%' + LOWER(TRIM(@MANV)) + '%'
--	AND	LOWER(TRANGTHAI) LIKE '%' + LOWER(TRIM(@TRANGTHAI)) + '%'
EXEC  SELECTALLHOADONTRACUU '','','','','',''
EXEC SELECTALLHOADON ''
DROP PROC SELECTALLHOADONTRACUU
SELECT * FROM HOADON WHERE SOHD = 'HD01' AND NGAYLAP = '2023-10-23' AND THANHTIEN = 2300000 AND MATOUR = 'T01' AND MAKH = 'KH01' AND MANV = 'NV01' 
SELECT * FROM NHANVIEN WHERE MANV = 
--------------------------------
--------------------------------
--------------------------------
--------------------------------
----- tìm kiếm nhân viên theo ngay sinh
create proc SELECTALLDATENV
	@NGAYSINH VARCHAR(15)
AS
	SELECT MANV,
	TENNV,
	CONVERT (VARCHAR(11),NGAYSINH,103) AS [NGAYSINH],
	GIOITINH,
	SDT,
	CCCD,
	CONVERT (VARCHAR(11),NGAYVL,103) AS [NGAYVL]
	FROM NHANVIEN
	WHERE LOWER(NGAYSINH) LIKE '%'+ LOWER(TRIM(@NGAYSINH)) +'%'
EXEC SELECTALLDATENV '2003-12-26'
---- tìm nhân viên theo ngày vào làm
create proc SELECTALLDATENVNGAYVL
	@NGAYVL VARCHAR(15)
AS
	SELECT MANV,
	TENNV,
	CONVERT (VARCHAR(11),NGAYSINH,103) AS [NGAYSINH],
	GIOITINH,
	SDT,
	CCCD,
	CONVERT (VARCHAR(11),NGAYVL,103) AS [NGAYVL]
	FROM NHANVIEN
	WHERE LOWER(NGAYVL) LIKE '%'+ LOWER(TRIM(@NGAYVL)) +'%'
EXEC SELECTALLDATENVNGAYVL '2023-07-07'
------- tìm nhan viên theo ngày sinh hoặc ngày vào làm

create proc SELECTALLDATENGAYSINHNGAYVL
		@NGAYSINH VARCHAR(15),
		@NGAYVL VARCHAR(15)
AS
	SELECT MANV,
	TENNV,
	CONVERT (VARCHAR(11),NGAYSINH,103) AS [NGAYSINH],
	GIOITINH,
	SDT,
	CCCD,
	CONVERT (VARCHAR(11),NGAYVL,103) AS [NGAYVL]
	FROM NHANVIEN
	WHERE LOWER(NGAYSINH) LIKE '%'+ LOWER(TRIM(@NGAYSINH)) +'%'
		AND	LOWER(NGAYVL) LIKE '%'+ LOWER(TRIM(@NGAYVL)) +'%'
EXEC SELECTALLDATENGAYSINHNGAYVL '2003-12-26','2023-07-07'
DROP PROC SELECTALLDATENGAYSINHNGAYVL
------ tim kiem theo ngay đi--------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------------------------------------
--------------------------------
--------------------------------
--------------------------------
create proc SELECTALLDATENGAYDI
	@NGAYDI VARCHAR(15)
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
	FROM TOUR
	WHERE LOWER(NGAYDI) LIKE '%' + LOWER(TRIM(@NGAYDI)) + '%'
EXEC SELECTALLDATENGAYDI '2023-08-07'
DROP PROC SELECTALLDATENGAYDI
---- tìm nhân viên theo ngày vào làm
create proc SELECTALLDATENVNGAYKETTHUC
	@NGAYKETTHUC VARCHAR(15)
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
	FROM TOUR
	WHERE LOWER(NGAYKETTHUC) LIKE '%' + LOWER(TRIM(@NGAYKETTHUC)) + '%'
EXEC SELECTALLDATENVNGAYKETTHUC '2023-08-17'
DROP PROC SELECTALLDATENVNGAYKETTHUC
------- tìm nhan viên theo ngày sinh hoặc ngày vào làm

create proc SELECTALLDATENGAYDINGAYKETTHUC
		@NGAYDI VARCHAR(15),
		@NGAYKETTHUC VARCHAR(15)
AS
	SELECT MATOUR,
	TENTOUR,
		GIATOUR,
		CONVERT (VARCHAR(11),NGAYDI,103) AS [NGAYDI],
		CONVERT (VARCHAR(11),NGAYKETTHUC,103) AS [NGAYKETTHUC],
	MOTA,
	MALOAITOUR,
	MADDEN,
	MADDI
	FROM TOUR
	WHERE LOWER(NGAYDI) LIKE '%' + LOWER(TRIM(@NGAYDI)) + '%'
		AND	LOWER(NGAYKETTHUC) LIKE '%'+ LOWER(TRIM(@NGAYKETTHUC)) +'%'
EXEC SELECTALLDATENGAYDINGAYKETTHUC '2023-08-07','2023-08-17'
DROP PROC SELECTALLDATENGAYDINGAYKETTHUC
----------------------------------
-------------------------
---- tìm theo ngày lập của hóa đơn
CREATE PROCEDURE SELECTALLNGAYLAPHOADON
	@NGAYLAP VARCHAR(15)
AS
	SELECT SOHD,
	CONVERT (VARCHAR(11),NGAYLAP,103) AS [NGÀY LẬP],
	THANHTIEN,MATOUR,MAKH,MAKH,TRANGTHAI
	FROM HOADON
	WHERE LOWER(NGAYLAP) LIKE '%' + LOWER(TRIM(@NGAYLAP)) + '%'
EXEC SELECTALLNGAYLAPHOADON '2023-10-23'
DROP PROC SELECTALLNGAYLAPHOADON
